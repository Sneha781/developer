name: Trigger Tester Repository

on:
  push: # Trigger on every push
    branches:
      - main

jobs:
  notify-tester:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Tester Repository
        run: |
         curl -X POST http://15.206.147.64:8080/job/test-run/buildWithParameters \
         --user Sneha781:11c4c7d9e0beade81a5a4d43cb1a0ce730 \
         --data "ENV=staging"
      # Step 3: Clone the Testing repository to a temporary directory
      - name: Clone Testing Repository
        run: |
          git clone https://Sneha781:${{ secrets.PERSONAL_ACCESS_TOKEN }}@github.com/Sneha781/tester/tmp/testing-repo

      # Step 4: Sync files from Developing to Testing repository
      - name: Sync Files to Testing Repository
        run: |
          rsync -av --delete ./ /tmp/testing-repo/ --exclude .git  # Sync excluding the .git folder
          cd /tmp/testing-repo
          git status  # Check the current status after sync

      # Step 5: Commit and Push changes to Testing repository
      - name: Commit and Push Changes
        run: |
          cd /tmp/testing-repo
          git add -A
          if git diff --cached --quiet; then
            echo "No changes to commit. Skipping push."
          else
            git commit -m "Auto-sync: Updating from Developing repository"
            git push origin main  # Push changes to Testing repository
          fi
